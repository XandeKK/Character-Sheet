var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};!function(e,u){a=u()}(0,(()=>(()=>{var a={95:(e,a,u)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DiceRoller=void 0;const c=u(51);a.DiceRoller=class{constructor(e,a=1e3){this.randFunction=Math.random,this.maxRollCount=1e3,e&&(this.randFunction=e),this.maxRollCount=a}parse(e){return c.parse(e)}roll(e){const a=c.parse(e);return this.rollType(a)}rollValue(e){return this.roll(e).value}rollParsed(e){return this.rollType(e)}rollType(e){let a;switch(e.type){case"diceExpression":a=this.rollDiceExpr(e);break;case"group":a=this.rollGroup(e);break;case"die":a=this.rollDie(e);break;case"expression":a=this.rollExpression(e);break;case"mathfunction":a=this.rollFunction(e);break;case"inline":a=this.rollType(e.expr);break;case"number":a=Object.assign(Object.assign({},e),{success:null,successes:0,failures:0,valid:!0,order:0});break;default:throw new Error(`Unable to render ${e.type}`)}return e.label&&(a.label=e.label),a}rollDiceExpr(e){const a=this.rollType(e.head),u=[a],c=[],d=e.ops.reduce(((e,a,d)=>{const h=this.rollType(a.tail);switch(h.order=d,u.push(h),c.push(a.op),a.op){case"+":return e+h.value;case"-":return e-h.value;default:return e}}),a.value);return{dice:u,ops:c,success:null,successes:0,failures:0,type:"diceexpressionroll",valid:!0,value:d,order:0}}rollGroup(e){let a=e.rolls.map(((e,a)=>Object.assign(Object.assign({},this.rollType(e)),{order:a}))),u=0,c=0,d=!1;if(e.mods){const h=e.mods,n=e=>(d=h.some((e=>["failure","success"].includes(e.type))),e=h.reduce(((e,a)=>this.applyGroupMod(e,a)),e),d&&(e=e.map((e=>(u+=e.successes,c+=e.failures,e.value=e.successes-e.failures,e.success=e.value>0,e)))),e);if(1===a.length&&["die","diceexpressionroll"].includes(a[0].type)){const e=a[0];let u="die"===e.type?e.rolls:e.dice.filter((e=>"number"!==e.type)).reduce(((e,a)=>[...e,..."die"===a.type?a.rolls:a.dice]),[]);u=n(u),e.value=u.reduce(((e,a)=>a.valid?e+a.value:e),0)}else a=n(a)}const h=a.reduce(((e,a)=>a.valid?e+a.value:e),0);return{dice:a,success:d?h>0:null,successes:u,failures:c,type:"grouproll",valid:!0,value:h,order:0}}rollDie(e){const a=this.rollType(e.count);if(a.value>this.maxRollCount)throw new Error("Entered number of dice too large.");let u,c;"fate"===e.die.type?(c={type:"fate",success:null,successes:0,failures:0,valid:!1,value:0,order:0},u=Array.from({length:a.value},((e,a)=>this.generateFateRoll(a)))):(c=this.rollType(e.die),u=Array.from({length:a.value},((e,a)=>this.generateDiceRoll(c.value,a)))),e.mods&&(u=e.mods.reduce(((e,a)=>this.applyMod(e,a)),u));let d=0,h=0;e.targets&&(u=e.targets.reduce(((e,a)=>this.applyMod(e,a)),u).map((e=>(d+=e.successes,h+=e.failures,e.value=e.successes-e.failures,e.success=e.value>0,e))));let p=!1,f=0;if(e.match){const a=e.match,c=u.reduce(((e,a)=>e.set(a.roll,(e.get(a.roll)||0)+1)),new Map),d=new Set(Array.from(c.entries()).filter((([e,u])=>u>=a.min.value)).filter((([e])=>!(a.mod&&a.expr)||this.successTest(a.mod,this.rollType(a.expr).value,e))).map((([e])=>e)));u.filter((e=>d.has(e.roll))).forEach((e=>e.matched=!0)),a.count&&(p=!0,f=d.size)}e.sort&&(u=this.applySort(u,e.sort));const v=u.reduce(((e,a)=>a.valid?e+a.value:e),0);return{count:a,die:c,rolls:u,success:e.targets?v>0:null,successes:d,failures:h,type:"die",valid:!0,value:p?f:v,order:0,matched:p}}rollExpression(e){const a=this.rollType(e.head),u=[a],c=[],d=e.ops.reduce(((e,a)=>{const d=this.rollType(a.tail);switch(u.push(d),c.push(a.op),a.op){case"+":return e+d.value;case"-":return e-d.value;case"*":return e*d.value;case"/":return e/d.value;case"%":return e%d.value;case"**":return e**d.value;default:return e}}),a.value);return{dice:u,ops:c,success:null,successes:0,failures:0,type:"expressionroll",valid:!0,value:d,order:0}}rollFunction(e){const a=this.rollType(e.expr);let u;switch(e.op){case"floor":u=Math.floor(a.value);break;case"ceil":u=Math.ceil(a.value);break;case"round":u=Math.round(a.value);break;case"abs":u=Math.abs(a.value);break;default:u=a.value}return{expr:a,op:e.op,success:null,successes:0,failures:0,type:"mathfunction",valid:!0,value:u,order:0}}applyGroupMod(e,a){return this.getGroupModMethod(a)(e)}getGroupModMethod(e){const r=e=>e.value;switch(e.type){case"success":return this.getSuccessMethod(e,r);case"failure":return this.getFailureMethod(e,r);case"keep":return this.getKeepMethod(e,r);case"drop":return this.getDropMethod(e,r);default:throw new Error(`Mod ${e.type} is not recognised`)}}applyMod(e,a){return this.getModMethod(a)(e)}getModMethod(e){const r=e=>e.roll;switch(e.type){case"success":return this.getSuccessMethod(e,r);case"failure":return this.getFailureMethod(e,r);case"crit":return this.getCritSuccessMethod(e,r);case"critfail":return this.getCritFailureMethod(e,r);case"keep":return a=>this.getKeepMethod(e,r)(a).sort(((e,a)=>e.order-a.order));case"drop":return a=>this.getDropMethod(e,r)(a).sort(((e,a)=>e.order-a.order));case"explode":return this.getExplodeMethod(e);case"compound":return this.getCompoundMethod(e);case"penetrate":return this.getPenetrateMethod(e);case"reroll":return this.getReRollMethod(e);case"rerollOnce":return this.getReRollOnceMethod(e);default:throw new Error(`Mod ${e.type} is not recognised`)}}applySort(e,a){return e.sort(((e,u)=>a.asc?e.roll-u.roll:u.roll-e.roll)),e.forEach(((e,a)=>e.order=a)),e}getCritSuccessMethod(e,a){const u=this.rollType(e.expr);return c=>c.map((c=>{if(!c.valid)return c;if("roll"!==c.type)return c;if(c.success)return c;const d=c;return this.successTest(e.mod,u.value,a(c))?d.critical="success":"success"===d.critical&&(d.critical=null),c}))}getCritFailureMethod(e,a){const u=this.rollType(e.expr);return c=>c.map((c=>{if(!c.valid)return c;if("roll"!==c.type)return c;if(c.success)return c;const d=c;return this.successTest(e.mod,u.value,a(c))?d.critical="failure":"failure"===d.critical&&(d.critical=null),c}))}getSuccessMethod(e,a){const u=this.rollType(e.expr);return c=>c.map((c=>c.valid?(this.successTest(e.mod,u.value,a(c))&&(c.successes+=1),c):c))}getFailureMethod(e,a){const u=this.rollType(e.expr);return c=>c.map((c=>c.valid?(this.successTest(e.mod,u.value,a(c))&&(c.failures+=1),c):c))}getKeepMethod(e,a){const u=this.rollType(e.expr);return c=>{if(0===c.length)return c;c=c.sort(((u,c)=>"l"===e.highlow?a(c)-a(u):a(u)-a(c))).sort(((e,a)=>(e.valid?1:0)-(a.valid?1:0)));const d=Math.max(Math.min(u.value,c.length),0);let h=0,p=0;const f=c.reduce(((e,a)=>(a.valid?1:0)+e),0)-d;for(;p<c.length&&h<f;)c[p].valid&&(c[p].valid=!1,c[p].drop=!0,h++),p++;return c}}getDropMethod(e,a){const u=this.rollType(e.expr);return c=>{c=c.sort(((u,c)=>"h"===e.highlow?a(c)-a(u):a(u)-a(c)));const d=Math.max(Math.min(u.value,c.length),0);let h=0,p=0;for(;p<c.length&&h<d;)c[p].valid&&(c[p].valid=!1,c[p].drop=!0,h++),p++;return c}}getExplodeMethod(e){const a=e.target?this.rollType(e.target.value):null;return u=>{const c=a?u=>this.successTest(e.target.mod,a.value,u.roll):e=>this.successTest("=","fateroll"===e.type?1:e.die,e.roll);if("roll"===u[0].type&&c({roll:1})&&c({roll:u[0].die}))throw new Error("Invalid reroll target");for(let e=0;e<u.length;e++){let a=u[e];a.order=e;let d=0;for(;c(a)&&d++<1e3;){a.explode=!0;const c=this.reRoll(a,++e);u.splice(e,0,c),a=c}}return u}}getCompoundMethod(e){const a=e.target?this.rollType(e.target.value):null;return u=>{const c=a?u=>this.successTest(e.target.mod,a.value,u.roll):e=>this.successTest("=","fateroll"===e.type?1:e.die,e.roll);if("roll"===u[0].type&&c({roll:1})&&c({roll:u[0].die}))throw new Error("Invalid reroll target");for(let e=0;e<u.length;e++){let a=u[e],d=a.roll,h=0;for(;c(a)&&h++<1e3;){a.explode=!0;const u=this.reRoll(a,e+1);d+=u.roll,a=u}u[e].value=d,u[e].roll=d}return u}}getPenetrateMethod(e){const a=e.target?this.rollType(e.target.value):null;return u=>{const c=a?u=>this.successTest(e.target.mod,a.value,u.roll):e=>this.successTest("=","fateroll"===e.type?1:e.die,e.roll);if(a&&"roll"===u[0].type&&c(u[0])&&this.successTest(e.target.mod,a.value,1))throw new Error("Invalid reroll target");for(let e=0;e<u.length;e++){let a=u[e];a.order=e;let d=0;for(;c(a)&&d++<1e3;){a.explode=!0;const c=this.reRoll(a,++e);c.value-=1,u.splice(e,0,c),a=c}}return u}}getReRollMethod(e){const a=e.target?this.successTest.bind(null,e.target.mod,this.rollType(e.target.value).value):this.successTest.bind(null,"=",1);return e=>{if("roll"===e[0].type&&a(1)&&a(e[0].die))throw new Error("Invalid reroll target");for(let u=0;u<e.length;u++)for(;a(e[u].roll);){e[u].reroll=!0,e[u].valid=!1;const a=this.reRoll(e[u],u+1);e.splice(++u,0,a)}return e}}getReRollOnceMethod(e){const a=e.target?this.successTest.bind(null,e.target.mod,this.rollType(e.target.value).value):this.successTest.bind(null,"=",1);return e=>{if("roll"===e[0].type&&a(1)&&a(e[0].die))throw new Error("Invalid reroll target");for(let u=0;u<e.length;u++)if(a(e[u].roll)){e[u].reroll=!0,e[u].valid=!1;const a=this.reRoll(e[u],u+1);e.splice(++u,0,a)}return e}}successTest(e,a,u){switch(e){case">":return u>=a;case"<":return u<=a;default:return u==a}}reRoll(e,a){switch(e.type){case"roll":return this.generateDiceRoll(e.die,a);case"fateroll":return this.generateFateRoll(a);default:throw new Error(`Cannot do a reroll of a ${e.type}.`)}}generateDiceRoll(e,a){const u=parseInt((this.randFunction()*e).toFixed(),10)+1;return{critical:u===e?"success":1===u?"failure":null,die:e,matched:!1,order:a,roll:u,success:null,successes:0,failures:0,type:"roll",valid:!0,value:u}}generateFateRoll(e){const a=Math.floor(3*this.randFunction())-1;return{matched:!1,order:e,roll:a,success:null,successes:0,failures:0,type:"fateroll",valid:!0,value:a}}}},619:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DiscordRollRenderer=void 0,a.DiscordRollRenderer=class{render(e){return this.doRender(e,!0)}doRender(e,a=!1){let u="";switch(e.type){case"diceexpressionroll":u=this.renderGroupExpr(e);break;case"grouproll":u=this.renderGroup(e);break;case"die":u=this.renderDie(e);break;case"expressionroll":u=this.renderExpression(e);break;case"mathfunction":u=this.renderFunction(e);break;case"roll":return this.renderRoll(e);case"fateroll":return this.renderFateRoll(e);case"number":const a=e.label?` (${e.label})`:"";return`${e.value}${a}`;case"fate":return"F";default:throw new Error("Unable to render")}return e.valid||(u="~~"+u.replace(/~~/g,"")+"~~"),a?this.stripBrackets(u):e.label?`(${e.label}: ${u})`:u}renderGroup(e){const a=[];for(const u of e.dice)a.push(this.doRender(u));return a.length>1?`{ ${a.join(" + ")} } = ${e.value}`:`{ ${this.stripBrackets(a[0])} } = ${e.value}`}renderGroupExpr(e){const a=[];for(const u of e.dice)a.push(this.doRender(u));return a.length>1?`(${a.join(" + ")} = ${e.value})`:a[0]}renderDie(e){const a=[];for(const u of e.rolls)a.push(this.doRender(u));let u=`${a.join(", ")}`;["number","fate"].includes(e.die.type)&&"number"===e.count.type||(u+=`[*Rolling: ${this.doRender(e.count)}d${this.doRender(e.die)}*]`);const c=e.matched?" Match"+(1===e.value?"":"es"):"";return u+=` = ${e.value}${c}`,`(${u})`}renderExpression(e){if(e.dice.length>1){const a=[];for(let u=0;u<e.dice.length-1;u++)a.push(this.doRender(e.dice[u])),a.push(e.ops[u]);return a.push(this.doRender(e.dice.slice(-1)[0])),a.push("="),a.push(e.value+""),`(${a.join(" ")})`}return"number"===e.dice[0].type?e.value+"":this.doRender(e.dice[0])}renderFunction(e){const a=this.doRender(e.expr);return`(${e.op}${this.addBrackets(a)} = ${e.value})`}addBrackets(e){return e.startsWith("(")||(e=`(${e}`),e.endsWith(")")||(e=`${e})`),e}stripBrackets(e){return e.startsWith("(")&&(e=e.substring(1)),e.endsWith(")")&&(e=e.substring(0,e.length-1)),e}renderRoll(e){let a=`${e.roll}`;return e.valid?e.success&&1===e.value?a=`**${e.roll}**`:e.success&&-1===e.value?a=`*${e.roll}*`:e.success||"success"!==e.critical?e.success||"failure"!==e.critical||(a=`*${e.roll}*`):a=`**${e.roll}**`:a=`~~${e.roll}~~`,e.matched&&(a=`__${a}__`),a}renderFateRoll(e){const a=0===e.roll?"0":e.roll>0?"+":"-";let u=`${e.roll}`;return e.valid?e.success&&1===e.value?u=`**${a}**`:e.success&&-1===e.value&&(u=`*${a}*`):u=`~~${a}~~`,e.matched&&(u=`__${u}__`),u}}},607:function(a,u,c){var d=(this||e)&&(this||e).__createBinding||(Object.create?function(e,a,u,c){void 0===c&&(c=u);var d=Object.getOwnPropertyDescriptor(a,u);d&&!("get"in d?!a.__esModule:d.writable||d.configurable)||(d={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(e,c,d)}:function(e,a,u,c){void 0===c&&(c=u),e[c]=a[u]}),h=(this||e)&&(this||e).__exportStar||function(e,a){for(var u in e)"default"===u||Object.prototype.hasOwnProperty.call(a,u)||d(a,e,u)};Object.defineProperty(u,"__esModule",{value:!0}),h(c(95),u),h(c(604),u),h(c(234),u),h(c(619),u),h(c(54),u)},604:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0})},234:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0})},54:(e,a)=>{Object.defineProperty(a,"__esModule",{value:!0})},51:a=>{function r(a,u,c,d){(this||e).message=a,(this||e).expected=u,(this||e).found=c,(this||e).location=d,(this||e).name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this||e,r)}!function(a,u){function t(){(this||e).constructor=a}t.prototype=u.prototype,a.prototype=new t}(r,Error),r.buildMessage=function(e,a){var u={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var a,u="";for(a=0;a<e.parts.length;a++)u+=e.parts[a]instanceof Array?s(e.parts[a][0])+"-"+s(e.parts[a][1]):s(e.parts[a]);return"["+(e.inverted?"^":"")+u+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function l(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+l(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+l(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+l(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+l(e)}))}return"Expected "+function(e){var a,c,d,h=new Array(e.length);for(a=0;a<e.length;a++)h[a]=(d=e[a],u[d.type](d));if(h.sort(),h.length>0){for(a=1,c=1;a<h.length;a++)h[a-1]!==h[a]&&(h[c]=h[a],c++);h.length=c}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(a)+" found."},a.exports={SyntaxError:r,parse:function(e,a){a=void 0!==a?a:{};var u,c={},d={start:Me},h=Me,p={type:"any"},f=ye("[[",!1),v=ye("]]",!1),i=function(e,a){return a&&(e.label=a),e},y=">",g=ye(">",!1),C="<",m=ye("<",!1),b="=",x=ye("=",!1),A=ye("f",!1),M=ye("cs",!1),R=ye("cf",!1),w=ye("m",!1),T=ye("t",!1),$=ye("k",!1),E=ye("l",!1),F=ye("h",!1),k=ye("d",!1),L=ye("{",!1),_=ye(",",!1),j=ye("}",!1),O="+",D=ye("+",!1),B=ye("s",!1),S=ye("a",!1),P=ye("!",!1),G=ye("!!",!1),I=ye("!p",!1),W=ye("r",!1),K=ye("ro",!1),U=ye("F",!1),J=ye("%",!1),V=ye("(",!1),q=ye(")",!1),H=ye("-",!1),z=function(e,a){return 0==a.length?e:{head:e,type:"expression",ops:a.map((e=>({type:"math",op:e[1],tail:e[3]})))}},N=ye("*",!1),Q=ye("/",!1),X="**",Y=ye("**",!1),Z="floor",ee=ye("floor",!1),re="ceil",te=ye("ceil",!1),le="round",oe=ye("round",!1),se=ye("abs",!1),ne=be("integer"),ae=/^[0-9]/,ue=me([["0","9"]],!1,!1),ce=ye("[",!1),ie=/^[^\]]/,de=me(["]"],!0,!1),he=ye("]",!1),pe=be("whitespace"),fe=/^[ \t\n\r]/,ve=me([" ","\t","\n","\r"],!1,!1),ge=0,Ne=0,Qe=[{line:1,column:1}],Xe=0,Ye=[],Ze=0;if("startRule"in a){if(!(a.startRule in d))throw new Error("Can't start parsing from rule \""+a.startRule+'".');h=d[a.startRule]}function ye(e,a){return{type:"literal",text:e,ignoreCase:a}}function me(e,a,u){return{type:"class",parts:e,inverted:a,ignoreCase:u}}function be(e){return{type:"other",description:e}}function xe(a){var u,c=Qe[a];if(c)return c;for(u=a-1;!Qe[u];)u--;for(c={line:(c=Qe[u]).line,column:c.column};u<a;)10===e.charCodeAt(u)?(c.line++,c.column=1):c.column++,u++;return Qe[a]=c,c}function Ae(e,a){var u=xe(e),c=xe(a);return{start:{offset:e,line:u.line,column:u.column},end:{offset:a,line:c.line,column:c.column}}}function Ce(e){ge<Xe||(ge>Xe&&(Xe=ge,Ye=[]),Ye.push(e))}function Me(){var a,u,d,h,f,v;if(a=ge,(u=We())!==c){for(d=[],e.length>ge?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(p));h!==c;)d.push(h),e.length>ge?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(p));d!==c?(Ne=a,v=d,(f=u).root=!0,v&&(f.label=v.join("")),a=u=f):(ge=a,a=c)}else ge=a,a=c;return a}function Re(){var a,u,d;return a=ge,62===e.charCodeAt(ge)?(u=y,ge++):(u=c,0===Ze&&Ce(g)),u===c&&(60===e.charCodeAt(ge)?(u=C,ge++):(u=c,0===Ze&&Ce(m)),u===c&&(61===e.charCodeAt(ge)?(u=b,ge++):(u=c,0===Ze&&Ce(x)))),u!==c&&(d=Be())!==c?(Ne=a,a=u={type:"success",mod:u,expr:d}):(ge=a,a=c),a}function we(){var a,u,d,h;return a=ge,102===e.charCodeAt(ge)?(u="f",ge++):(u=c,0===Ze&&Ce(A)),u!==c?(62===e.charCodeAt(ge)?(d=y,ge++):(d=c,0===Ze&&Ce(g)),d===c&&(60===e.charCodeAt(ge)?(d=C,ge++):(d=c,0===Ze&&Ce(m)),d===c&&(61===e.charCodeAt(ge)?(d=b,ge++):(d=c,0===Ze&&Ce(x)))),d===c&&(d=null),d!==c&&(h=Be())!==c?(Ne=a,a=u={type:"failure",mod:d,expr:h}):(ge=a,a=c)):(ge=a,a=c),a}function Te(){var a,u,d,h;return a=ge,"cs"===e.substr(ge,2)?(u="cs",ge+=2):(u=c,0===Ze&&Ce(M)),u!==c?(62===e.charCodeAt(ge)?(d=y,ge++):(d=c,0===Ze&&Ce(g)),d===c&&(60===e.charCodeAt(ge)?(d=C,ge++):(d=c,0===Ze&&Ce(m)),d===c&&(61===e.charCodeAt(ge)?(d=b,ge++):(d=c,0===Ze&&Ce(x)))),d===c&&(d=null),d!==c&&(h=Be())!==c?(Ne=a,a=u={type:"crit",mod:d,expr:h}):(ge=a,a=c)):(ge=a,a=c),a}function $e(){var a,u,d,h;return a=ge,"cf"===e.substr(ge,2)?(u="cf",ge+=2):(u=c,0===Ze&&Ce(R)),u!==c?(62===e.charCodeAt(ge)?(d=y,ge++):(d=c,0===Ze&&Ce(g)),d===c&&(60===e.charCodeAt(ge)?(d=C,ge++):(d=c,0===Ze&&Ce(m)),d===c&&(61===e.charCodeAt(ge)?(d=b,ge++):(d=c,0===Ze&&Ce(x)))),d===c&&(d=null),d!==c&&(h=Be())!==c?(Ne=a,a=u={type:"critfail",mod:d,expr:h}):(ge=a,a=c)):(ge=a,a=c),a}function Ee(){var a,u,d,h;return a=ge,107===e.charCodeAt(ge)?(u="k",ge++):(u=c,0===Ze&&Ce($)),u!==c?(108===e.charCodeAt(ge)?(d="l",ge++):(d=c,0===Ze&&Ce(E)),d===c&&(104===e.charCodeAt(ge)?(d="h",ge++):(d=c,0===Ze&&Ce(F))),d===c&&(d=null),d!==c?((h=Be())===c&&(h=null),h!==c?(Ne=a,a=u={type:"keep",highlow:d,expr:h||rr}):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}function Fe(){var a,u,d,h;return a=ge,100===e.charCodeAt(ge)?(u="d",ge++):(u=c,0===Ze&&Ce(k)),u!==c?(108===e.charCodeAt(ge)?(d="l",ge++):(d=c,0===Ze&&Ce(E)),d===c&&(104===e.charCodeAt(ge)?(d="h",ge++):(d=c,0===Ze&&Ce(F))),d===c&&(d=null),d!==c?((h=Be())===c&&(h=null),h!==c?(Ne=a,a=u={type:"drop",highlow:d,expr:h||rr}):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}function ke(){var a,u,d,h,p,f,v,y,g,C;if(a=ge,(u=_e())!==c){for(d=[],h=ge,(p=Le())!==c?(43===e.charCodeAt(ge)?(f=O,ge++):(f=c,0===Ze&&Ce(D)),f!==c&&(v=Le())!==c&&(y=_e())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);h!==c;)d.push(h),h=ge,(p=Le())!==c?(43===e.charCodeAt(ge)?(f=O,ge++):(f=c,0===Ze&&Ce(D)),f!==c&&(v=Le())!==c&&(y=_e())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);d!==c?(Ne=a,g=u,a=u=0==(C=d).length?g:{head:g,type:"diceExpression",ops:C.map((e=>({type:"math",op:e[1],tail:e[3]})))}):(ge=a,a=c)}else ge=a,a=c;return a}function _e(){var e;return(e=je())===c&&(e=We()),e}function je(){var a,u,d;return a=ge,u=function(){var a,u,d,h,p;if(a=ge,u=function(){var a,u,d,h,p,f;if(a=ge,u=function(){var a,u,d,h;return a=ge,(u=Be())===c&&(u=null),u!==c?(100===e.charCodeAt(ge)?(d="d",ge++):(d=c,0===Ze&&Ce(k)),d!==c?(h=function(){var a,u;return a=ge,70===e.charCodeAt(ge)?(u="F",ge++):(u=c,0===Ze&&Ce(U)),u===c&&(102===e.charCodeAt(ge)?(u="f",ge++):(u=c,0===Ze&&Ce(A))),u!==c&&(Ne=a,u={type:"fate"}),u}(),h===c&&(h=function(){var a,u;return a=ge,37===e.charCodeAt(ge)?(u="%",ge++):(u=c,0===Ze&&Ce(J)),u!==c&&(Ne=a,u={type:"number",value:"100"}),u}(),h===c&&(h=Be())),h!==c?(Ne=a,a=u={die:h,count:u||{type:"number",value:1},type:"die"}):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}(),u!==c){for(d=[],(h=De())===c&&(h=Se())===c&&(h=Oe())===c&&(h=Ge())===c&&(h=Pe());h!==c;)d.push(h),(h=De())===c&&(h=Se())===c&&(h=Oe())===c&&(h=Ge())===c&&(h=Pe());d!==c?(Ne=a,f=d,(p=u).mods=(p.mods||[]).concat(f),a=u=p):(ge=a,a=c)}else ge=a,a=c;return a}(),u!==c){for(d=[],(h=Fe())===c&&(h=Ee())===c&&(h=Re())===c&&(h=we())===c&&(h=$e())===c&&(h=Te());h!==c;)d.push(h),(h=Fe())===c&&(h=Ee())===c&&(h=Re())===c&&(h=we())===c&&(h=$e())===c&&(h=Te());d!==c?((h=function(){var a,u,d,h,p;return a=ge,109===e.charCodeAt(ge)?(u="m",ge++):(u=c,0===Ze&&Ce(w)),u!==c?(116===e.charCodeAt(ge)?(d="t",ge++):(d=c,0===Ze&&Ce(T)),d===c&&(d=null),d!==c?((h=He())===c&&(h=null),h!==c?(p=function(){var a,u,d;return a=ge,62===e.charCodeAt(ge)?(u=y,ge++):(u=c,0===Ze&&Ce(g)),u===c&&(60===e.charCodeAt(ge)?(u=C,ge++):(u=c,0===Ze&&Ce(m)),u===c&&(61===e.charCodeAt(ge)?(u=b,ge++):(u=c,0===Ze&&Ce(x)))),u!==c&&(d=Be())!==c?(Ne=a,a=u={mod:u,expr:d}):(ge=a,a=c),a}(),p===c&&(p=null),p!==c?(Ne=a,a=u=function(e,a,u){const c={type:"match",min:a||{type:"number",value:2},count:!!e};return u&&(c.mod=u.mod,c.expr=u.expr),c}(d,h,p)):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}())===c&&(h=null),h!==c?(p=function(){var a,u,d;return a=ge,115===e.charCodeAt(ge)?(u="s",ge++):(u=c,0===Ze&&Ce(B)),u!==c?(97===e.charCodeAt(ge)?(d="a",ge++):(d=c,0===Ze&&Ce(S)),d===c&&(100===e.charCodeAt(ge)?(d="d",ge++):(d=c,0===Ze&&Ce(k))),d===c&&(d=null),d!==c?(Ne=a,a=u="d"==d?{type:"sort",asc:!1}:{type:"sort",asc:!0}):(ge=a,a=c)):(ge=a,a=c),a}(),p===c&&(p=null),p!==c?(Ne=a,a=u=function(e,a,u,c){const d=a.filter((e=>["success","failure"].includes(e.type)));return a=a.filter((e=>!d.includes(e))),e.mods=(e.mods||[]).concat(a),d.length>0&&(e.targets=d),u&&(e.match=u),c&&(e.sort=c),e}(u,d,h,p)):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c)}else ge=a,a=c;return a}(),u!==c&&Le()!==c?((d=Je())===c&&(d=null),d!==c?(Ne=a,a=u=i(u,d)):(ge=a,a=c)):(ge=a,a=c),a}function Oe(){var a,u,d;return a=ge,33===e.charCodeAt(ge)?(u="!",ge++):(u=c,0===Ze&&Ce(P)),u!==c?((d=Ie())===c&&(d=null),d!==c?(Ne=a,a=u={type:"explode",target:d}):(ge=a,a=c)):(ge=a,a=c),a}function De(){var a,u,d;return a=ge,"!!"===e.substr(ge,2)?(u="!!",ge+=2):(u=c,0===Ze&&Ce(G)),u!==c?((d=Ie())===c&&(d=null),d!==c?(Ne=a,a=u={type:"compound",target:d}):(ge=a,a=c)):(ge=a,a=c),a}function Se(){var a,u,d;return a=ge,"!p"===e.substr(ge,2)?(u="!p",ge+=2):(u=c,0===Ze&&Ce(I)),u!==c?((d=Ie())===c&&(d=null),d!==c?(Ne=a,a=u={type:"penetrate",target:d}):(ge=a,a=c)):(ge=a,a=c),a}function Pe(){var a,u,d;return a=ge,114===e.charCodeAt(ge)?(u="r",ge++):(u=c,0===Ze&&Ce(W)),u!==c?((d=Ie())===c&&(d=null),d!==c?(Ne=a,a=u={type:"reroll",target:d||er}):(ge=a,a=c)):(ge=a,a=c),a}function Ge(){var a,u,d;return a=ge,"ro"===e.substr(ge,2)?(u="ro",ge+=2):(u=c,0===Ze&&Ce(K)),u!==c?((d=Ie())===c&&(d=null),d!==c?(Ne=a,a=u={type:"rerollOnce",target:d||er}):(ge=a,a=c)):(ge=a,a=c),a}function Ie(){var a,u,d;return a=ge,62===e.charCodeAt(ge)?(u=y,ge++):(u=c,0===Ze&&Ce(g)),u===c&&(60===e.charCodeAt(ge)?(u=C,ge++):(u=c,0===Ze&&Ce(m)),u===c&&(61===e.charCodeAt(ge)?(u=b,ge++):(u=c,0===Ze&&Ce(x)))),u===c&&(u=null),u!==c&&(d=Be())!==c?(Ne=a,a=u={type:"target",mod:u,value:d}):(ge=a,a=c),a}function Be(){var e;return(e=Ke())===c&&(e=He()),e}function We(){var a;return(a=function(){var a,u,d,h;return a=ge,"[["===e.substr(ge,2)?(u="[[",ge+=2):(u=c,0===Ze&&Ce(f)),u!==c&&(d=We())!==c?("]]"===e.substr(ge,2)?(h="]]",ge+=2):(h=c,0===Ze&&Ce(v)),h!==c?(Ne=a,a=u={type:"inline",expr:d}):(ge=a,a=c)):(ge=a,a=c),a}())===c&&(a=Ue())===c&&(a=Ke()),a}function Ke(){var a,u,d,h,p,f,v;return a=ge,40===e.charCodeAt(ge)?(u="(",ge++):(u=c,0===Ze&&Ce(V)),u!==c&&(d=Ue())!==c?(41===e.charCodeAt(ge)?(h=")",ge++):(h=c,0===Ze&&Ce(q)),h!==c&&Le()!==c?((p=Je())===c&&(p=null),p!==c?(Ne=a,f=d,(v=p)&&(f.label=v),a=u=f):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}function Ue(){var a,u,d,h,p,f,v,y;if(a=ge,(u=ze())!==c){for(d=[],h=ge,(p=Le())!==c?(43===e.charCodeAt(ge)?(f=O,ge++):(f=c,0===Ze&&Ce(D)),f===c&&(45===e.charCodeAt(ge)?(f="-",ge++):(f=c,0===Ze&&Ce(H))),f!==c&&(v=Le())!==c&&(y=ze())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);h!==c;)d.push(h),h=ge,(p=Le())!==c?(43===e.charCodeAt(ge)?(f=O,ge++):(f=c,0===Ze&&Ce(D)),f===c&&(45===e.charCodeAt(ge)?(f="-",ge++):(f=c,0===Ze&&Ce(H))),f!==c&&(v=Le())!==c&&(y=ze())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);d!==c?(Ne=a,a=u=z(u,d)):(ge=a,a=c)}else ge=a,a=c;return a}function ze(){var a,u,d,h,p,f,v,y;if(a=ge,(u=Ve())!==c){for(d=[],h=ge,(p=Le())!==c?(42===e.charCodeAt(ge)?(f="*",ge++):(f=c,0===Ze&&Ce(N)),f===c&&(47===e.charCodeAt(ge)?(f="/",ge++):(f=c,0===Ze&&Ce(Q))),f!==c&&(v=Le())!==c&&(y=Ve())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);h!==c;)d.push(h),h=ge,(p=Le())!==c?(42===e.charCodeAt(ge)?(f="*",ge++):(f=c,0===Ze&&Ce(N)),f===c&&(47===e.charCodeAt(ge)?(f="/",ge++):(f=c,0===Ze&&Ce(Q))),f!==c&&(v=Le())!==c&&(y=Ve())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);d!==c?(Ne=a,a=u=z(u,d)):(ge=a,a=c)}else ge=a,a=c;return a}function Ve(){var a,u,d,h,p,f,v,y;if(a=ge,(u=qe())!==c){for(d=[],h=ge,(p=Le())!==c?(e.substr(ge,2)===X?(f=X,ge+=2):(f=c,0===Ze&&Ce(Y)),f===c&&(37===e.charCodeAt(ge)?(f="%",ge++):(f=c,0===Ze&&Ce(J))),f!==c&&(v=Le())!==c&&(y=qe())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);h!==c;)d.push(h),h=ge,(p=Le())!==c?(e.substr(ge,2)===X?(f=X,ge+=2):(f=c,0===Ze&&Ce(Y)),f===c&&(37===e.charCodeAt(ge)?(f="%",ge++):(f=c,0===Ze&&Ce(J))),f!==c&&(v=Le())!==c&&(y=qe())!==c?h=p=[p,f,v,y]:(ge=h,h=c)):(ge=h,h=c);d!==c?(Ne=a,a=u=z(u,d)):(ge=a,a=c)}else ge=a,a=c;return a}function qe(){var a;return(a=function(){var a,u,d,h,p;return a=ge,u=function(){var a;return e.substr(ge,5)===Z?(a=Z,ge+=5):(a=c,0===Ze&&Ce(ee)),a===c&&(e.substr(ge,4)===re?(a=re,ge+=4):(a=c,0===Ze&&Ce(te)),a===c&&(e.substr(ge,5)===le?(a=le,ge+=5):(a=c,0===Ze&&Ce(oe)),a===c&&("abs"===e.substr(ge,3)?(a="abs",ge+=3):(a=c,0===Ze&&Ce(se))))),a}(),u!==c&&Le()!==c?(40===e.charCodeAt(ge)?(d="(",ge++):(d=c,0===Ze&&Ce(V)),d!==c&&Le()!==c&&(h=Ue())!==c&&Le()!==c?(41===e.charCodeAt(ge)?(p=")",ge++):(p=c,0===Ze&&Ce(q)),p!==c?(Ne=a,a=u={type:"mathfunction",op:u,expr:h}):(ge=a,a=c)):(ge=a,a=c)):(ge=a,a=c),a}())===c&&(a=function(){var a,u,d;return a=ge,u=function(){var a,u,d,h,p,f,v,y;if(a=ge,u=function(){var a,u,d,h,p,f,v,y,g;if(a=ge,123===e.charCodeAt(ge)?(u="{",ge++):(u=c,0===Ze&&Ce(L)),u!==c)if(Le()!==c)if((d=ke())!==c){for(h=[],p=ge,(f=Le())!==c?(44===e.charCodeAt(ge)?(v=",",ge++):(v=c,0===Ze&&Ce(_)),v!==c&&(y=Le())!==c&&(g=ke())!==c?p=f=[f,v,y,g]:(ge=p,p=c)):(ge=p,p=c);p!==c;)h.push(p),p=ge,(f=Le())!==c?(44===e.charCodeAt(ge)?(v=",",ge++):(v=c,0===Ze&&Ce(_)),v!==c&&(y=Le())!==c&&(g=ke())!==c?p=f=[f,v,y,g]:(ge=p,p=c)):(ge=p,p=c);h!==c&&(p=Le())!==c?(125===e.charCodeAt(ge)?(f="}",ge++):(f=c,0===Ze&&Ce(j)),f!==c?(Ne=a,a=u={rolls:[d,...h.map((e=>e[3]))],type:"group"}):(ge=a,a=c)):(ge=a,a=c)}else ge=a,a=c;else ge=a,a=c;else ge=a,a=c;return a}(),u!==c){for(d=[],(h=Ee())===c&&(h=Fe())===c&&(h=Re())===c&&(h=we());h!==c;)d.push(h),(h=Ee())===c&&(h=Fe())===c&&(h=Re())===c&&(h=we());d!==c&&(h=Le())!==c?((p=Je())===c&&(p=null),p!==c?(Ne=a,f=u,y=p,(v=d).length>0&&(f.mods=(f.mods||[]).concat(v)),y&&(f.label=y),a=u=f):(ge=a,a=c)):(ge=a,a=c)}else ge=a,a=c;return a}(),u===c&&(u=je())===c&&(u=He()),u!==c&&Le()!==c?((d=Je())===c&&(d=null),d!==c?(Ne=a,a=u=i(u,d)):(ge=a,a=c)):(ge=a,a=c),a}())===c&&(a=Ke()),a}function He(){var a,u,d,h;if(Ze++,a=ge,45===e.charCodeAt(ge)?(u="-",ge++):(u=c,0===Ze&&Ce(H)),u===c&&(u=null),u!==c){if(d=[],ae.test(e.charAt(ge))?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(ue)),h!==c)for(;h!==c;)d.push(h),ae.test(e.charAt(ge))?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(ue));else d=c;d!==c?(Ne=a,a=u={type:"number",value:parseInt(e.substring(Ne,ge),10)}):(ge=a,a=c)}else ge=a,a=c;return Ze--,a===c&&(u=c,0===Ze&&Ce(ne)),a}function Je(){var a,u,d,h;if(a=ge,91===e.charCodeAt(ge)?(u="[",ge++):(u=c,0===Ze&&Ce(ce)),u!==c){if(d=[],ie.test(e.charAt(ge))?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(de)),h!==c)for(;h!==c;)d.push(h),ie.test(e.charAt(ge))?(h=e.charAt(ge),ge++):(h=c,0===Ze&&Ce(de));else d=c;d!==c?(93===e.charCodeAt(ge)?(h="]",ge++):(h=c,0===Ze&&Ce(he)),h!==c?(Ne=a,a=u=d.join("")):(ge=a,a=c)):(ge=a,a=c)}else ge=a,a=c;return a}function Le(){var a,u;for(Ze++,a=[],fe.test(e.charAt(ge))?(u=e.charAt(ge),ge++):(u=c,0===Ze&&Ce(ve));u!==c;)a.push(u),fe.test(e.charAt(ge))?(u=e.charAt(ge),ge++):(u=c,0===Ze&&Ce(ve));return Ze--,a===c&&(u=c,0===Ze&&Ce(pe)),a}const er={type:"target",mod:"=",value:{type:"number",value:1}},rr={type:"number",value:1};if((u=h())!==c&&ge===e.length)return u;throw u!==c&&ge<e.length&&Ce({type:"end"}),tr=Ye,lr=Xe<e.length?e.charAt(Xe):null,or=Xe<e.length?Ae(Xe,Xe+1):Ae(Xe,Xe),new r(r.buildMessage(tr,lr),tr,lr,or);var tr,lr,or}}}},u={};return function t(e){var c=u[e];if(void 0!==c)return c.exports;var d=u[e]={exports:{}};return a[e].call(d.exports,d,d.exports,t),d.exports}(607)})()));var u=a;export{u as default};

