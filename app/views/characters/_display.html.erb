<%= link_to "edit", edit_character_path(character), class: "btn btn-primary position-fixed bottom-0 end-0 m-4", style: "z-index: 99;", data: {turbo: false} %>

<div class="card my-5">
  <div class="card-header">
    <h4>Basics</h4>
  </div>
  <div class="card-body">
    <div id="introduce">
      <h1 id="characterName"><%= get_name character_json%></h1>
      <h3 id="classAndLevel"><%= get_class_and_level character_json%></h3>
      <div class="row text-center">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Perception</span>
          <span class="col" id="perception"><%= get_perception character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Speed</span>
          <span class="col" id="speed"><%= get_speed character_json %></span>
        </p>
      </div>
      <div class="row justify-content-center">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Size</span>
          <span class="col ms-2" id="size"><%= get_size character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Ancestry</span>
          <span class="col ms-2" id="ancestry"><%= get_ancestry character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Heritage</span>
          <span class="col ms-2" id="heritage"><%= get_heritage character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Background</span>
          <span class="col ms-2" id="background"><%= get_background character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">Traits</span>
          <span class="col ms-2" id="traits"><%= get_traits character_json %></span>
        </p>
        <p class="col row">

          <span class="col-12 fw-semibold text-danger">Hero Points</span>
          <span class="col ms-2" id="heroPoints"><%= get_hero_points character_json %></span>
        </p>
        <p class="col row">
          <span class="col-12 fw-semibold text-danger">EXP</span>
          <span class="col ms-2" id="experiencePoints"><%= get_experience_points character_json %></span>
        </p>
      </div>
    </div>
  </div>
</div>

<div class="card my-5">
  <div class="card-header">
    <h4>Statistics</h4>
  </div>
  <div class="card-body">
    <div class="row text-center">
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="strength">STR <%= get_ability("strength", character_json) %></span>
          <span class="col " id="strengthModifier"><%= get_ability_modifier("strength", character_json) %></span>
        </p>
      </div>
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="dexterity">DEX <%= get_ability("dexterity", character_json) %> </span>
          <span class="col" id="dexterityModifier"><%= get_ability_modifier("dexterity", character_json) %></span>
        </p>
      </div>
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="constitution">CON <%= get_ability("constitution", character_json) %> </span>
          <span class="col" id="constitutionModifier"><%= get_ability_modifier("constitution", character_json) %></span>
        </p>
      </div>
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="intelligence">INT <%= get_ability("intelligence", character_json) %></span>
          <span class="col" id="intelligenceModifier"><%= get_ability_modifier("intelligence", character_json) %></span>
        </p>
      </div>
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="wisdom">WIS <%= get_ability("wisdom", character_json) %></span>
          <span class="col" id="wisdomModifier"><%= get_ability_modifier("wisdom", character_json) %></span>
        </p>
      </div>
      <div class="col">
        <p class="col row">
          <span class="col-12 fw-semibold text-danger" id="charisma">CHA <%= get_ability("charisma", character_json) %></span>
          <span class="col" id="charismaModifier"><%= get_ability_modifier("charisma", character_json) %></span>
        </p>
      </div>
    </div>
    <div class="row row-cols-auto">
      <span class="col-12 fw-semibold text-danger">Languages</span>
      <div class="ms-2">
        <% character_json["languages"].each do |language| %>
          <%= language["name"] %>
          /
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="card my-5">
  <div class="card-header">
    <h4>Defense</h4>
  </div>
  <div class="card-body">
    <div class="row">
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">HP</span>
          <span class="col-auto ms-2 hp" id="<%= dom_id(character, :hp) %>"><%= get_current_and_max_hp character_json %></span>
        </p>
        <div class="col-sm input-group btn-group h-50">
          <input type="number" class="form-control inputHp" id="<%= dom_id(character, :inputHp) %>" placeholder="HP" aria-label="HP">
          <button type="button" class="btn btn-danger damageBtn" character_id="<%= character.id %>">-</button>
          <button type="button" class="btn btn-success healBtn" character_id="<%= character.id %>">+</button>
        </div>
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">Temporary HP</span>
          <span class="col-auto ms-2 temporary" id="<%= dom_id(character, :temporary) %>"><%= get_temporary_hp character_json %></span>
        </p>
        <div class="col-sm input-group btn-group h-50">
          <input type="number" class="form-control inputTemporary" id="<%= dom_id(character, :inputTemporary) %>" placeholder="Temporary HP">
          <button type="button" class="btn btn-success temporaryBtn" character_id="<%= character.id %>">+</button>
        </div>
    </div>
    <div class="row">
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">AC</span>
          <span class="col-8 ms-2" id="ac"><%= get_AC character_json %></span>
        </p>
    </div>
    <div class="row">
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">Resistances and immunities</span>
          <span class="col-8 ms-2" id="resistancesAndImmunities"><%= get_resistances_and_immunities character_json %></span>
        </p>
    </div>
    <div class="row">
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">Fortitude</span>
          <span class="col-8 ms-2" id="fortitude"><%= get_saving_throws("fortitude", "constitution", character_json) %></span>
        </p>
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">Reflex</span>
          <span class="col-8 ms-2" id="reflex"><%= get_saving_throws("reflex", "dexterity", character_json) %></span>
        </p>
        <p class="col-auto row">
          <span class="col-12 fw-semibold text-danger">Will</span>
          <span class="col-8 ms-2" id="will"><%= get_saving_throws("will", "wisdom", character_json) %></span>
        </p>
    </div>
  </div>
</div>

<div class="card my-5">
  <div class="card-header">
    <h4>Offense</h4>
  </div>
  <div class="card-body">
    <ul class="list-group">
      <% character_json["meleeStrikes"].each do |melee| %>
        <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-action" role="button">
          <div>
            <div class="row">
              <span class="col-12 fw-semibold text-danger">Weapon</span>
              <span class="col-9 ms-3 text-truncate"><%= melee["weapon"] %></span>
            </div>
            <div class="row">
              <span class="col-12 fw-semibold text-danger">Attack</span>
              <span class="col-9 ms-3 text-truncate">+<%= attackRoll(melee) %></span>
            </div>
          </div>
          <div>
            <div class="col row">
              <span class="col-12 fw-semibold text-danger">Damage</span>
              <span class="col ms-3"><%= melee["dice"] %></span>
            </div>
            <div class="col row">
              <span class="col-12 fw-semibold text-danger">Type</span>
              <span class="col ms-3"><%= melee["types"] %></span>
            </div>
          </div>
          <div class="row">
          </div>
          <div class="btn">
            <i class="fa-solid fa-dice"></i>
          </div>
        </li>
      <% end %>
    </ul>
    <ul class="list-group mt-4">
      <% character_json["rangedStrikes"].each do |ranged| %>
        <li class="list-group-item d-flex justify-content-between align-items-center list-group-item-action" role="button">
          <div>
            <div class="row">
              <span class="col-12 fw-semibold text-danger">Weapon</span>
              <span class="col-9 ms-3 text-truncate"><%= ranged["weapon"] %></span>
            </div>
            <div class="row">
              <span class="col-12 fw-semibold text-danger">Attack</span>
              <span class="col-9 ms-3 text-truncate">+<%= attackRoll(ranged) %></span>
            </div>
          </div>
          <div>
            <div class="col row">
              <span class="col-12 fw-semibold text-danger">Damage</span>
              <span class="col ms-3"><%= ranged["dice"] %></span>
            </div>
            <div class="col row">
              <span class="col-12 fw-semibold text-danger">Type</span>
              <span class="col ms-3"><%= ranged["types"] %></span>
            </div>
            <div class="row">
              <span class="col-12 fw-semibold text-danger">Range</span>
              <span class="col-9 ms-3 text-truncate"><%= ranged["range"] %>ft</span>
            </div>
          </div>
          <div class="row">
          </div>
          <div class="btn">
            <i class="fa-solid fa-dice"></i>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<div class="card my-5">
  <div class="card-header">
    <h3 class="">Skills</h3>
    <ul class="nav nav-pills" role="tablist">
      <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#card-div-skills" aria-controls="skills" type="button" aria-selected="true" role="tab">Skills</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#card-div-skillFeats" aria-controls="skillFeats" type="button" aria-selected="false" role="tab" tabindex="-1">Skill Feats</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#card-div-ancestryFeatsAndAbilities" aria-controls="ancestryFeatsAndAbilities" type="button" aria-selected="false" role="tab" tabindex="-1">Ancestry Feats</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#card-div-classFeatsAndAbilities" aria-controls="classFeatsAndAbilities" type="button" aria-selected="false" role="tab" tabindex="-1">Class Feats</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#card-div-generalFeats" aria-controls="generalFeats" type="button" aria-selected="false" role="tab" tabindex="-1">General Feats</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#card-div-bonusFeats" aria-controls="bonusFeats" type="button" aria-selected="false" role="tab" tabindex="-1">Bonus Feats</button></li>
    </ul>
  </div>
  <div class="card-body tab-content">
    <div id="card-div-skills" class="tab-pane fade active show" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["skills"].each do |skill| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= skill["name"]%></span>
              <!-- Observação: isso não está correto, por que não sendo somado pelo item e nem modificador de habilidade -->
              <span><%= getSkillModifier(skill, character_json["ability"]) %></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div id="card-div-skillFeats" class="tab-pane fade" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["skillFeats"].each do |skillFeat| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= skillFeat["name"]%></span>
              <span>Level: <%= skillFeat["level"]%></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div id="card-div-ancestryFeatsAndAbilities" class="tab-pane fade" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["ancestryFeatsAndAbilities"].each do |ancestryFeatAndAbility| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= ancestryFeatAndAbility["name"]%></span>
              <span>Level: <%= ancestryFeatAndAbility["level"]%></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div id="card-div-classFeatsAndAbilities" class="tab-pane fade" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["classFeatsAndAbilities"].each do |classFeatAndAbility| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= classFeatAndAbility["name"]%></span>
              <span>Level: <%= classFeatAndAbility["level"]%></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div id="card-div-generalFeats" class="tab-pane fade" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["generalFeats"].each do |generalFeat| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= generalFeat["name"]%></span>
              <span>Level: <%= generalFeat["level"]%></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div id="card-div-bonusFeats" class="tab-pane fade" role="tabpanel">
      <div class="row gx-3 gy-2 align-items-center">
        <ul class="list-group list-group-flush">
          <% character_json["bonusFeats"].each do |bonusFeat| %>
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
              <span><%= bonusFeat["name"]%></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="card my-5">
  <div class="card-header">
    <h4>Inventory</h4>
  </div>
  <div class="card-body">
    <ul class="list-group list-group-flush">
      <% character_json["inventory"].each do |inventory| %>
        <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" role="button">
          <span><%= inventory["name"] %></span>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<script>
  json = <%= get_life(character) %>
</script>